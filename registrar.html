<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Registrar • Aquiservicio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{--navy:#0b1220;--navy2:#0f1a33;--card:rgba(255,255,255,.94);--txt:#0f172a;--shadow:0 20px 70px rgba(2,6,23,.18)}
    *{box-sizing:border-box}
    body{
      margin:0;font-family:Inter,system-ui,Arial;color:var(--txt);
      background:radial-gradient(900px 600px at 10% 0%, rgba(56,189,248,.14), transparent 60%),
               radial-gradient(900px 600px at 90% 10%, rgba(99,102,241,.12), transparent 55%),
               linear-gradient(180deg, var(--navy), var(--navy2));
      min-height:100vh; padding:16px; display:flex; justify-content:center;
    }
    .wrap{width:min(720px,100%)}
    .card{background:var(--card); border-radius:22px; box-shadow:var(--shadow); padding:14px}
    h1{margin:0 0 10px; font-size:18px; letter-spacing:.08em; text-transform:uppercase}
    label{display:block; margin:12px 0 6px; font-weight:900; font-size:13px; color:rgba(15,23,42,.75)}
    input, select, textarea{
      width:100%; padding:12px 14px; border-radius:14px; border:1px solid rgba(15,23,42,.16);
      font-weight:800; font-size:14px; font-family:inherit;
    }
    textarea{min-height:92px; resize:vertical}
    .row{display:grid; grid-template-columns:1fr; gap:10px}
    @media (min-width:680px){ .row{grid-template-columns:1fr 1fr} }
    button{
      margin-top:14px; width:100%;
      padding:14px 14px; border-radius:16px;
      border:1px solid rgba(56,189,248,.35);
      background:linear-gradient(180deg, rgba(56,189,248,.18), rgba(99,102,241,.12));
      font-weight:900; cursor:pointer;
    }
    .msg{margin-top:12px; padding:10px; border-radius:14px; border:1px solid rgba(15,23,42,.12); background:rgba(2,6,23,.03); font-weight:900}
    .err{border-color:rgba(239,68,68,.35); background:rgba(239,68,68,.10)}
    .ok{border-color:rgba(34,197,94,.35); background:rgba(34,197,94,.10)}
    .small{font-size:12px; color:rgba(15,23,42,.70); font-weight:800}
    .hp{display:none !important}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Registrar negocio</h1>
      <div class="small">Tu solicitud se revisa y se aprueba antes de publicarse.</div>

      <form id="f">
        <!-- Honeypot anti-bot -->
        <input class="hp" id="hp" autocomplete="off" tabindex="-1" />

        <div class="row">
          <div>
            <label>Tipo</label>
            <select id="kind" required>
              <option value="food">Comida</option>
              <option value="service">Servicios</option>
            </select>
          </div>
          <div>
            <label>Localidad</label>
            <input id="locality" placeholder="Ej: Navolato Centro" required />
          </div>
        </div>

        <label>Nombre del negocio</label>
        <input id="name" required placeholder="Ej: Tacos Juan" />

        <label>¿Qué ofreces? (categoría principal)</label>
        <input id="category" required placeholder="Ej: tacos, sushi, mecánico, dentista..." />

        <label>Descripción (corta y clara)</label>
        <textarea id="desc" placeholder="Ej: Tacos de asada y también tortas. Domicilio en Navolato Centro."></textarea>

        <div class="row">
          <div>
            <label>WhatsApp (solo números)</label>
            <input id="whatsapp" required placeholder="6671234567" inputmode="numeric" />
          </div>
          <div>
            <label>Teléfono (opcional)</label>
            <input id="phone" placeholder="Opcional" inputmode="numeric" />
          </div>
        </div>

        <label>Tags (separados por coma)</label>
        <input id="tags" placeholder="Ej: tortas, carne asada, aguas frescas" />

        <div class="row">
          <div>
            <label>Opciones</label>
            <div class="small">
              <input type="checkbox" id="delivery"> Domicilio &nbsp; • &nbsp;
              <input type="checkbox" id="pickup"> Ordena y recoge &nbsp; • &nbsp;
              <input type="checkbox" id="dinein"> Solo sucursal
            </div>
          </div>
          <div>
            <label>Servicios</label>
            <div class="small">
              <input type="checkbox" id="available"> Disponible ahora
            </div>
          </div>
        </div>

        <button type="submit">Enviar solicitud ✅</button>
        <div id="msg" class="msg" style="display:none;"></div>
      </form>

      <div class="small" style="margin-top:12px;">
        <a href="index.html">← Volver al inicio</a>
      </div>
    </div>
  </div>

  <script>
    const f = document.getElementById("f");
    const msg = document.getElementById("msg");
    const showMsg = (text, ok=true) => {
      msg.style.display = "block";
      msg.className = "msg " + (ok ? "ok" : "err");
      msg.textContent = text;
    };

    f.addEventListener("submit", async (e) => {
      e.preventDefault();
      msg.style.display = "none";

      const tagsRaw = document.getElementById("tags").value.trim();
      const tags = tagsRaw
        ? tagsRaw.split(",").map(t => t.trim()).filter(Boolean).slice(0, 20)
        : [];

      const body = {
        hp: document.getElementById("hp").value,
        kind: document.getElementById("kind").value,
        locality: document.getElementById("locality").value.trim(),
        name: document.getElementById("name").value.trim(),
        category: document.getElementById("category").value.trim(),
        description: document.getElementById("desc").value.trim(),
        whatsapp: document.getElementById("whatsapp").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        tags,
        delivery: document.getElementById("delivery").checked,
        pickup: document.getElementById("pickup").checked,
        dine_in: document.getElementById("dinein").checked,
        available_now: document.getElementById("available").checked
      };

      const r = await fetch("/api/register", {
        method: "POST",
        headers: { "content-type": "application/json" },
        body: JSON.stringify(body)
      });

      const outText = await r.text();
      let out = {};
      try { out = outText ? JSON.parse(outText) : {}; } catch(_){}

      if (!r.ok || out.error) {
        showMsg("Error: " + (out.error || ("HTTP " + r.status)), false);
        return;
      }

      showMsg("Solicitud enviada ✅ ID: " + out.business_id, true);
      f.reset();
    });
  </script>
</body>
</html>
